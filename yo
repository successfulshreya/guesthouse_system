euzu omkt kgxh ysod




book_room.php
<?php
session_start();
if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'user') {
    header("Location: ../index.php");
    exit();
}
include '../db_connect.php';

// Helper to output an error and stop
function show_error($msg) {
    echo "<!DOCTYPE html><html><head>
            <title>Error</title>
            <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'>
          </head><body>
          <div class='container mt-5'>
            <div class='alert alert-danger'>" . htmlspecialchars($msg) . "</div>
            <a href='availability.php' class='btn btn-secondary'>Back to Availability</a>
          </div>
          </body></html>";
    exit();
}

// If GET: show booking form
if ($_SERVER['REQUEST_METHOD'] === 'GET') {
    if (!isset($_GET['guesthouse_id'], $_GET['room_id'], $_GET['checkin_date'], $_GET['checkout_date'])) {
        show_error("Missing booking parameters.");
    }
    $guesthouse_id = intval($_GET['guesthouse_id']);
    $room_id = intval($_GET['room_id']);
    $checkin = $_GET['checkin_date'];
    $checkout = $_GET['checkout_date'];

    // Optional: you can check availability here again to prevent hacking
    $stmt = $conn->prepare("
        SELECT 1 FROM bookings
        WHERE room_id = ?
          AND checkin_date < ?
          AND checkout_date > ?
        LIMIT 1
    ");
    $stmt->bind_param("iss", $room_id, $checkout, $checkin);
    $stmt->execute();
    $stmt->store_result();
    if ($stmt->num_rows > 0) {
        $stmt->close();
        show_error("Sorry, that room is no longer available for the selected dates.");
    }
    $stmt->close();

    ?>
    <!DOCTYPE html>
    <html>
    <head>
        <title>Confirm Booking</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body>
    <div class="container mt-4">
      <h2>Confirm Booking</h2>
      <form method="POST" action="book_room.php">
          <input type="hidden" name="guesthouse_id" value="<?= htmlspecialchars($guesthouse_id) ?>">
          <input type="hidden" name="room_id" value="<?= htmlspecialchars($room_id) ?>">
          <input type="hidden" name="checkin_date" value="<?= htmlspecialchars($checkin) ?>">
          <input type="hidden" name="checkout_date" value="<?= htmlspecialchars($checkout) ?>">

          <div class="mb-3">
              <label for="guest_name" class="form-label">Guest Name</label>
              <input type="text" class="form-control" id="guest_name" name="guest_name" required>
          </div>
          <div class="mb-3">
              <label for="guest_designation" class="form-label">Guest Designation</label>
              <input type="text" class="form-control" id="guest_designation" name="guest_designation" required>
          </div>
          <button type="submit" class="btn btn-primary">Book</button>
          <a href="availability.php?guesthouse_id=<?= urlencode($guesthouse_id) ?>&checkin=<?= urlencode($checkin) ?>&checkout=<?= urlencode($checkout) ?>" class="btn btn-secondary">Cancel</a>
      </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    </body>
    </html>
    <?php
    exit();
}

// If POST: process booking
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $required = ['guesthouse_id', 'room_id', 'checkin_date', 'checkout_date', 'guest_name', 'guest_designation'];
    foreach ($required as $f) {
        if (!isset($_POST[$f]) || trim($_POST[$f]) === '') {
            show_error("Missing or invalid field: $f");
        }
    }

    $guesthouse_id = intval($_POST['guesthouse_id']);
    $room_id = intval($_POST['room_id']);
    $checkin = $_POST['checkin_date'];
    $checkout = $_POST['checkout_date'];
    $guest_name = trim($_POST['guest_name']);
    $guest_designation = trim($_POST['guest_designation']);

    // Validate dates
    $today = date('Y-m-d');
    if ($checkin < $today) {
        show_error("Check-in date cannot be in the past.");
    }
    if ($checkout <= $checkin) {
        show_error("Check-out must be after check-in.");
    }

    // Check that the room belongs to the guesthouse
    $stmt = $conn->prepare("SELECT id FROM rooms WHERE id = ? AND guesthouse_id = ?");
    $stmt->bind_param("ii", $room_id, $guesthouse_id);
    $stmt->execute();
    $res = $stmt->get_result();
    if ($res->num_rows === 0) {
        $stmt->close();
        show_error("Invalid room / guesthouse selection.");
    }
    $stmt->close();

    // Check overlapping booking
    $stmt2 = $conn->prepare("
        SELECT 1 FROM bookings
        WHERE room_id = ?
          AND checkin_date < ?
          AND checkout_date > ?
        LIMIT 1
    ");
    $stmt2->bind_param("iss", $room_id, $checkout, $checkin);
    $stmt2->execute();
    $stmt2->store_result();
    if ($stmt2->num_rows > 0) {
        $stmt2->close();
        show_error("Room is already booked during selected dates.");
    }
    $stmt2->close();

    // Insert booking
    $user_id = $_SESSION['user_id'];
    $stmt3 = $conn->prepare("
        INSERT INTO bookings (user_id, room_id, guest_name, guest_designation, checkin_date, checkout_date)
        VALUES (?, ?, ?, ?, ?, ?)
    ");
    $stmt3->bind_param("iissss",
        $user_id,
        $room_id,
        $guest_name,
        $guest_designation,
        $checkin,
        $checkout
    );
    $ok = $stmt3->execute();
    if (!$ok) {
        // optionally log error: $stmt3->error
        show_error("Failed to book room. Please try later.");
    }
    $stmt3->close();

    // Success
    echo "<!DOCTYPE html><html><head>
            <title>Booking Confirmed</title>
            <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet'>
          </head><body>
          <div class='container mt-5'>
            <div class='alert alert-success'>Booking confirmed successfully.</div>
            <a href='my_booking.php' class='btn btn-primary'>Go to My Bookings</a>
          </div>
          </body></html>";
    exit();
}

// Fallback
show_error("Unsupported request method.");
?>












report.php
$guesthouse_id = isset($_GET['guesthouse_id']) ?
intval($_GET['guesthouse_id']) : 0;






book_room.php updated after 

<?php
session_start();
if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'user') {
    header("Location: ../index.php");
    exit();
}

include '../db_connect.php';
include '../includes/mail_config.php';

// fetch guesthouses
$gh_result = $conn->query("SELECT id, name, address FROM guesthouses ORDER BY name");

$msg = '';
if (isset($_GET['success'])) {
    $msg = "Room booked successfully!";
}

// handle booking submission
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $user_id = $_SESSION['user_id'];
    $guesthouse_id = intval($_POST['guesthouse_id']);
    $room_id = intval($_POST['room_id']);
    $checkin_date = trim($_POST['checkin_date']);
    $checkout_date = trim($_POST['checkout_date']);
    $guest_name = trim($_POST['guest_name']);
    $guest_designation = trim($_POST['guest_designation']);

    if ($guesthouse_id && $room_id && $checkin_date && $checkout_date && $guest_name) {
        // check room availability
        $stmt = $conn->prepare("SELECT id FROM bookings WHERE room_id = ? AND checkin_date < ? AND checkout_date > ? AND status IN ('pending','approved')");
        $stmt->bind_param("iss", $room_id, $checkout_date, $checkin_date);
        $stmt->execute();
        $stmt->store_result();

        if ($stmt->num_rows > 0) {
            $msg = "Room is already booked for the selected dates.";
        } else {
            $stmt->close();

            // insert booking with guest info and pending status
            $stmt = $conn->prepare(
                "INSERT INTO bookings (user_id, room_id, checkin_date, checkout_date, guest_name, guest_designation, status)
                 VALUES (?, ?, ?, ?, ?, ?, 'pending')"
            );
            $stmt->bind_param("iissss", $user_id, $room_id, $checkin_date, $checkout_date, $guest_name, $guest_designation);

            if ($stmt->execute()) {
                $stmt->close();

                // âœ… abhi yaha mail bhejna hai
                $admin_email = "shreyasahuu01@gmail.com";
                $subject = "New Room Booking Request";
                $body = "<h3>New Room Booking Request</h3>
                         <p>User <b>{$user_id}</b> has made a new booking request for room <b>{$room_id}</b>.</p>
                         <p>Check-in: {$checkin_date}</p>
                         <p>Check-out: {$checkout_date}</p>
                         <p>Guest Name: {$guest_name}</p>
                         <p>Guest Designation: {$guest_designation}</p>";

                sendMail($admin_email, $subject, $body);

                // mark room as booked
                $up = $conn->prepare("UPDATE rooms SET status='booked' WHERE id=?");
                $up->bind_param("i", $room_id);
                $up->execute();
                $up->close();

                header("Location: book_room.php?success=1");
                exit();
            } else {
                $msg = "Error: " . htmlspecialchars($stmt->error);
            }
        }
        $stmt->close();
    } else {
        $msg = "Please fill all required fields (Guest Name, Guesthouse, Room, Dates).";
    }
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>Book Room</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <script>
        // Fetch rooms dynamically based on guesthouse
        function loadRooms(guesthouseId) {
            if (!guesthouseId) {
                document.getElementById("roomSelect").innerHTML = "<option value=''>Select guesthouse first</option>";
                return;
            }
            fetch("get_room.php?guesthouse_id=" + guesthouseId)
            .then(res => res.text())
            .then(data => {
                document.getElementById("roomSelect").innerHTML = data;
            })
            .catch(err => console.error("Error fetching rooms:", err));
        }
    </script>
    <style>
      body {
        min-height: 100vh;
        display: flex;
      }
      .sidebar {
        width: 220px;
        background: #343a40;
        color: #fff;
        flex-shrink: 0;
      }
      .sidebar .nav-link { color: #ddd; }
      .sidebar .nav-link.active { background: #495057; color: #fff; }
      .sidebar .nav-link:hover { background: #495057; color: #fff; }
      .sidebar .nav-link i { margin-right: 8px; }
      .main-content { flex-grow: 1; padding: 20px; }
      .topbar {
        height: 60px;
        background: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        border-bottom: 1px solid #e0e0e0;
      }
      .card-action { cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
      .card-action:hover { transform: translateY(-4px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar d-flex flex-column p-3">
    <a href="#" class="d-flex align-items-center mb-3 text-white text-decoration-none">
      <i class="bi bi-gear-fill fs-4"></i>
      <span class="fs-4">User Panel</span>
    </a>
    <hr>
    <ul class="nav nav-pills flex-column">
      <li class="nav-item"><a href="Dashboard.php" class="nav-link"><i class="bi bi-building"></i> Dashboard</a></li>
      <li class="nav-item"><a href="availability.php" class="nav-link"><i class="bi bi-building"></i> Availability</a></li>
      <li class="nav-item"><a href="my_booking.php" class="nav-link"><i class="bi bi-door-open"></i> My Bookings</a></li>
      <li class="nav-item"><a href="book_room.php" class="nav-link active"><i class="bi bi-calendar-check"></i> Book Room</a></li>
      <li class="nav-item mt-auto"><a href="../logout.php" class="nav-link"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
    </ul>
  </nav>

  <!-- Main content area -->
  <div class="main-content">
    <div class="topbar">
      <h5>Dashboard</h5>
      <h4>SARDA ENERY and MINERALS LTD</h4>
      <div><span class="me-3">Welcome, User</span></div>
    </div>

    <div class="container mb-3"><br>
      <h2 class="mt-3 mb-3">Book Rooms for Guests</h2>

      <?php if (!empty($msg)): ?>
          <div class='alert alert-info'><?= htmlspecialchars($msg) ?></div>
      <?php endif; ?>

      <form method="POST">
          <div class="mb-3">
              <label for="guest_name" class="form-label">Guest Name</label>
              <input type="text" name="guest_name" id="guest_name" class="form-control" required>
          </div>

          <div class="mb-3">
              <label for="guest_designation" class="form-label">Guest Designation</label>
              <input type="text" name="guest_designation" id="guest_designation" class="form-control">
          </div>

          <div class="mb-3">
              <label for="guesthouse_id" class="form-label">Guesthouse</label>
              <select name="guesthouse_id" id="guesthouse_id" class="form-control" required onchange="loadRooms(this.value)">
                  <option value="">Select a guesthouse</option>
                  <?php
                  if ($gh_result) {
                      while ($row = $gh_result->fetch_assoc()) {
                          echo '<option value="' . intval($row['id']) . '">' . htmlspecialchars($row['name']) . '</option>';
                      }
                  }
                  ?>
              </select>
          </div>

          <div class="mb-3">
              <label for="room_id" class="form-label">Room</label>
              <select name="room_id" id="roomSelect" class="form-control" required>
                  <option value="">Select a room</option>
              </select>
          </div>

          <div class="mb-3">
              <label for="checkin_date" class="form-label">Check-in Date</label>
              <input type="date" name="checkin_date" id="checkin_date" class="form-control" required>
          </div>

          <div class="mb-3">
              <label for="checkout_date" class="form-label">Check-out Date</label>
              <input type="date" name="checkout_date" id="checkout_date" class="form-control" required>
          </div>

          <button class="btn btn-primary">Book Room</button>
          <a href="dashboard.php" class="btn btn-secondary">Back</a>
      </form>
    </div>
  </div>
</body>
</html>


new availability live for dashbo
<?php 
session_start();
include '../db_connect.php';

$guesthouse_id = 13; 

// Prepare the SQL statement.
$sql = "SELECT r.id, r.room_id, IF(b.id IS NOT NULL, 'booked', 'available') AS today_status 
        FROM rooms r
        LEFT JOIN bookings b ON r.id = b.room_id AND CURDATE() BETWEEN b.checkin_date AND b.checkout_date 
        WHERE r.guesthouse_id = ?";
$stmt = $conn->prepare($sql);

// Check for a preparation error.
if ($stmt === false) {
    die('Prepare failed: ' . htmlspecialchars($conn->error));
}

// Bind the parameter. The correct syntax is "$stmt->bind_param(...)".
$stmt->bind_param("i", $guesthouse_id);

// Execute the statement.
$stmt->execute();

// Get the result.
$result = $stmt->get_result();
?>

<!DOCTYPE html>
<html>
    <head>
        <title>Today's Availability</title>
        <style>
            /* Basic styling for the room display */
            .room-box {
                margin: 5px;
                padding: 10px;
                width: 120px;
                border: 1px solid #ccc;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <h3>Today's Room Availability</h3>
        <div style="display:flex; flex-wrap:wrap;">
            <?php 
            // The while loop must enclose the HTML content you want to repeat.
            while ($row = $result->fetch_assoc()) {
            ?>
                <div class="room-box" style="background-color: <?= $row['today_status'] == 'available' ? '#a8f0a3' : '#f0a3a3'; ?>;">
                    <?= htmlspecialchars($row['room_id']) ?><br>
                    <strong><?= ucfirst($row['today_status']) ?></strong>
                </div>
            <?php 
            } // Close the while loop here.
            ?>
        </div>
    </body>
</html>

<?php
// Close the statement and connection when you're done.
$stmt->close();
$conn->close();
?>



<!-- report.php -->
<?php
session_start();
if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'user') {
    header("Location: ../index.php");
    exit();
}

include '../db_connect.php';

$user_id = $_SESSION['user_id'];
$from = $_GET['from'] ?? '';
$to = $_GET['to'] ?? '';
$data = [];

if ($from && $to) {
    $sql = "SELECT b.* , r.room_id AS room_label
            FROM bookings b
            JOIN rooms r ON b.room_id = r.id
            WHERE b.user_id = ?
            AND b.checkin_date BETWEEN ? AND ?";

    $stmt = $conn->prepare($sql);

    if (!$stmt) {
        die("SQL Prepare Failed: " . $conn->error);  // helpful debugging
    }

    $stmt->bind_param("iss", $user_id, $from, $to);
    $stmt->execute();
    $data = $stmt->get_result();
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>Booking Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
        }

         body {
            min-height: 100vh;
            display: flex;
            background-color: #f0f2f5; /* Light gray background for a modern feel */
        }
        .sidebar {
            width: 250px; /* Slightly wider sidebar */
            background: #212529; /* Darker background for more contrast */
            color: #fff;
            flex-shrink: 0;
            transition: width 0.3s;
        }
        .sidebar-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #495057;
        }
        .sidebar .nav-link {
            color: #adb5bd; /* Lighter gray text */
            padding: 15px 20px;
        }
        .sidebar .nav-link.active {
            background: #495057;
            color: #fff;
            border-left: 3px solid #0d6efd; /* Highlight active link */
        }
        .sidebar .nav-link:hover {
            background: #343a40;
            color: #fff;
        }
        .sidebar .nav-link i {
            margin-right: 12px;
            font-size: 1.2rem;
        }
        .main-content {
            flex-grow: 1;
            padding: 20px;
        }
        .topbar {
         height: 70px;
         background: #fff;
         display: flex;
         align-items: center;
         justify-content: space-between;
         padding: 0 20px;
         border-bottom: 1px solid #e0e0e0;
         margin-bottom: 20px;
         border-radius: 8px; /* Rounded corners for the topbar */
         box-shadow: 0 2px 4px rgba(0,0,0,0.05); /* Subtle shadow */
        }
    </style>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/shim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script> -->


</head>
    <body>
        <!-- Sidebar -->
        <nav class="sidebar d-flex flex-column">
            <div class="sidebar-header">
                <a href="#" class="d-flex align-items-center text-white text-decoration-none">
                    <i class="bi bi-people fs-1"></i>
                    <span class="fs-4 ms-3"><h6>USER<h6 class="text-white-50">(Book Room)</h6></h6></span>
                </a>
            </div>

            <ul class="nav nav-pills flex-column flex-grow-1 p-3">
                <li class="nav-item">
               <a href="dashboard.php" class="nav-link"><i class="bi bi-building"></i> Dashboard</a>
               </li>

               <li class="nav-item">
               <a href="availability.php" class="nav-link"><i class="bi bi-building"></i> Availability</a>
               </li>

               <li class="nav-item">
               <a href="my_booking.php" class="nav-link"><i class="bi bi-door-open"></i> My Bookings</a>
               </li>

               <li class="nav-item">
               <a href="book_room.php" class="nav-link"><i class="bi bi-calendar-check"></i> Book Room</a>
               </li>

               <li class="nav-item">
               <a href="report.php" class="nav-link"><i class="bi bi-journal"></i>Booking Report</a>
               </li>
            </ul>

            <div class="p-3">
                <a href="../logout.php" class="nav-link text-white-50"><i class="bi bi-box-arrow-right"></i> Logout</a>
            </div>
        </nav>

        <!-- Main content area -->
        <div class="main-content">
            <div class="topbar">
                <h5 class="mb-0">Dashboard</h5>
                <div class="d-flex align-items-center">
                <h6 class="mb-0 me-3" style="color:chocolate;">SARDA ENERGY and MINERALS LTD</h6>
                <span>Welcome, User</span>
            </div>
        </div>
        
    <h3>Booking Report</h3>
    
    <form method="get" class="mb-3">
        <label>From:</label>
        <input type="date" name="from" required value="<?= htmlspecialchars($from) ?>">

        <label>To:</label>
        <input type="date" name="to" required value="<?= htmlspecialchars($to) ?>">

        <button type="submit">View</button>
    </form>

    <?php if ($from && $to): ?>
        <?php if ($data && $data->num_rows > 0): ?>
            <table>
                <div class="mb-3">
                   <button class="btn btn-success btn-sm" onclick="copyReport()"> Copy</button>
                   <button class="btn btn-success btn-sm" onclick="printReport()"> Print </button>
                   <!-- <button class="btn btn-success btn-sm" onclick="exportExcel()"> Export</button> -->
                </div>
                <tr>
                    <th>Room</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                    <th>Total Cost (Rs)</th>
                </tr>
                <?php while ($b = $data->fetch_assoc()): ?>
                    <tr>
                        <td><?= htmlspecialchars($b['room_label']) ?></td>
                        <td><?= htmlspecialchars($b['checkin_date']) ?></td>
                        <td><?= htmlspecialchars($b['checkout_date']) ?></td>
                        <td>Rs <?= number_format($b['total_cost'], 2) ?></td>
                    </tr>
                <?php endwhile; ?>
            </table>
        <?php else: ?>
            <p>No bookings found in this date range.</p>
        <?php endif; ?>
        <?php endif; ?>
        <script>
            function printReport(){
                const reportTable = document.querySelector('table');
                if(!reportTable){
                    alert("NO report to print!");
                    return;
                }
                const newWin = window.open('','_blank');
                newWin.document.write('<html><head><title>Print Report</title>');
                newWin.document.write('<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">');
                newWin.document.write('</head><body>');
                newWin.document.write(reportTable.outerHTML);
                newWin.document.write('</body></html>');
                newWin.document.close();
                newWin.print();
            }
            function copyReport(){
                const reportTable= document.querySelector('table');
                if(!reportTable){
                    alert("No report to copy");
                    return;
                }
                const range = document.createRange();
                range.selectNode(reportTable);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                try{
                    document.execCommand('copy');
                    alert('Report copied to clipboard');
                }catch(err){
                    alert('failed to copy Report!');
                }
                window.getSelection().removeAllRanges();
            }

        //     function exportExcel(){
        //     let table = document.getElementById("reportTable");
        //     let wb = XLSX.utils.table_to_book(table,{sheet:"Report"});
        //     XLSX.writeFile(wb,"Guesthouse_Report.xlsx");
        //    }
        // </script>
        <!-- // <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script> -->

    </body>
</html>

user dashboard


<?php
session_start();
if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'user') {
    header("Location: ../index.php");
    exit();
}
?>

<?php
include '../db_connect.php';
$guesthouse_id = 13; 

// Prepare the SQL statement.
$sql = "SELECT r.id, r.room_id, IF(b.id IS NOT NULL, 'booked', 'available') AS today_status 
        FROM rooms r
        LEFT JOIN bookings b ON r.id = b.room_id AND CURDATE() BETWEEN b.checkin_date AND b.checkout_date 
        WHERE r.guesthouse_id = ?";
$stmt = $conn->prepare($sql);

if ($stmt === false) {
    die('Prepare failed: ' . htmlspecialchars($conn->error));
}

$stmt->bind_param("i", $guesthouse_id);
$stmt->execute();
$result = $stmt->get_result();
?>

<!DOCTYPE html>
<html>
<head>
    <title>User Panel Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        body {
            min-height: 100vh;
            display: flex;
            background-color: #f5f7fb;
            font-family: 'Segoe UI', sans-serif;
        }
        /* SIDEBAR */
        .sidebar {
            width: 250px;
            background: #ffffff;
            color: #333;
            flex-shrink: 0;
            border-right: 1px solid #e3e6ee;
            box-shadow: 2px 0 8px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .sidebar-header {
            padding: 25px 15px;
            text-align: center;
        }
        .sidebar-header img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 12px;
            margin-bottom: 10px;
        }
        .sidebar .user-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }
        .sidebar .user-subtitle {
            font-size: 12px;
            color: #6c757d;
        }
        .sidebar .nav-link {
            color: #333;
            padding: 14px 20px;
            border-radius: 6px;
            margin: 2px 8px;
            font-size: 15px;
            display: flex;
            align-items: center;
            transition: 0.3s;
        }
        .sidebar .nav-link:hover {
            background: #e9f1ff;
            color: #0d6efd;
        }
        .sidebar .nav-link.active {
            background: #0d6efd;
            color: #fff !important;
        }
        .sidebar .nav-link i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        /* MAIN CONTENT */
        .main-content {
            flex-grow: 1;
            padding: 20px;
        }
        .topbar {
            height: 70px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .welcome-card {
            background-color: #0d6efd;
            color: #fff;
            text-align: center;
            padding: 25px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        /* ROOM BOXES */
        .avail {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }
        .avail h6 {
            font-weight: 600;
        }
        .room-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .room-box {
            width: 100px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 13px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }

        /* STATUS COLORS - Blue Theme */
        .room-available {
            background-color: #cfe8ff;
            color: #004085;
        }
        .room-booked {
            background-color: #f0f0f0;
            color: #6c757d;
        }

        /* CARDS */
        .card-action {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e9ecef;
        }
        .card-action:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .card-action .card-body {
            display: flex;
            align-items: center;
            padding: 25px;
        }
        .card-action .icon-circle {
            background: #f8f9fa;
            border-radius: 50%;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
        }
        .card-action .icon-circle i {
            font-size: 2rem;
            color: #0d6efd;
        }
    </style>
</head>
<body>

<!-- Sidebar -->
<nav class="sidebar">
    <div>
        <div class="sidebar-header">
            <img src="lo.png" alt="Logo">
            <div class="user-title">USER</div>
            <div class="user-subtitle">(Reports)</div>
        </div>

        <ul class="nav nav-pills flex-column">
            <li class="nav-item"><a href="dashboard.php" class="nav-link active"><i class="bi bi-house-fill"></i> Dashboard</a></li>
            <li class="nav-item"><a href="availability.php" class="nav-link"><i class="bi bi-building"></i> Availability</a></li>
            <li class="nav-item"><a href="my_booking.php" class="nav-link"><i class="bi bi-card-list"></i> My Bookings</a></li>
            <li class="nav-item"><a href="book_room.php" class="nav-link"><i class="bi bi-calendar-check"></i> Book Room</a></li>
            <li class="nav-item"><a href="report.php" class="nav-link"><i class="bi bi-journal"></i> Booking Report</a></li>
        </ul>
    </div>

    <div class="p-3">
        <a href="../logout.php" class="nav-link text-muted"><i class="bi bi-box-arrow-right"></i> Logout</a>
    </div>
</nav>

<!-- Main Content -->
<div class="main-content">
    <div class="topbar">
        <h5 class="mb-0">Dashboard</h5>
        <div class="d-flex align-items-center">
            <h6 class="mb-0 me-3" style="color:chocolate;">SARDA ENERGY and MINERALS LTD </h6>
            <span> Welcome, User</span>
            <i class="bi bi-person-circle fs-2 ms-2"></i>
        </div>
    </div>

    <div class="container-fluid">
        <div class="welcome-card mb-4">
            <h1 class="display-4">Welcome, User!</h1>
            <p class="lead">Book a room for your guests with ease.</p>
        </div>

        <div class="avail">
            <!-- VIP Karishma -->
            <div>
                <h6>Today's Room Availability <b style="color: #4556e9ff;">[VIP KARISHMA (RAIPUR)]</b></h6>
                <div class="room-container">
                    <?php while($row = $result->fetch_assoc()) { ?>
                        <div class="room-box <?= $row['today_status']=='available' ? 'room-available' : 'room-booked' ?>">
                            <?= htmlspecialchars($row['room_id']) ?><br>
                            <strong><?= ucfirst($row['today_status']) ?></strong>
                        </div>
                    <?php } ?>
                </div>
            </div>

            <!-- Colony Siltara -->
            <div>
                <h6>Today's Room Availability <b style="color: #3f4aeeff;">[COLONY (Siltara)]</b></h6>
                <div class="room-container">
                    <!-- Example, replace with actual PHP loop if data available -->
                    <div class="room-box room-available">101<br><strong>Available</strong></div>
                    <div class="room-box room-booked">102<br><strong>Booked</strong></div>
                    <div class="room-box room-available">103<br><strong>Available</strong></div>
                </div>
            </div>
        </div>

        <!-- Action Cards -->
        <div class="row g-4">
            <div class="col-md-6 col-lg-4">
                <a href="my_booking.php" class="text-decoration-none">
                    <div class="card card-action h-100">
                        <div class="card-body">
                            <div class="icon-circle">
                                <i class="bi bi-door-open"></i>
                            </div>
                            <h5 class="card-title mb-0">My Bookings</h5>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col-md-6 col-lg-4">
                <a href="book_room.php" class="text-decoration-none">
                    <div class="card card-action h-100">
                        <div class="card-body">
                            <div class="icon-circle">
                                <i class="bi bi-calendar-check"></i>
                            </div>
                            <h5 class="card-title mb-0">Book a Room</h5>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col-md-6 col-lg-4">
                <a href="availability.php" class="text-decoration-none">
                    <div class="card card-action h-100">
                        <div class="card-body">
                            <div class="icon-circle">
                                <i class="bi bi-building"></i>
                            </div>
                            <h5 class="card-title mb-0">Check Available Rooms</h5>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoC54FuqKaufMkyO5o6FGSh+I4q3p5KlvTXCUzwx4Pp1FBr"
        crossorigin="anonymous"></script>
</body>
</html>
<?php
$stmt->close();
$conn->close();
?>






admin dashboard.php

<?php
session_start();
if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'admin') {
    header("Location: ../index.php");
    exit();
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">

    <style>
        body {
            min-height: 100vh;
            display: flex;
            background-color: #f0f2f5;
        }

        /* SIDEBAR */
        .sidebar {
            width: 250px;
            background: linear-gradient(180deg, #1976d2, #42a5f5);
            color: #fff;
            flex-shrink: 0;
            transition: width 0.3s ease;
        }
        .sidebar.collapsed {
            width: 80px;
        }
        .sidebar-header {
            padding: 20px;
            text-align: center;
        }
        .sidebar .nav-link {
            color: #e3e3e3;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 5px 10px;
            transition: background 0.2s;
        }
        .sidebar .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
            border-left: 4px solid #ffffff;
        }
        .sidebar .nav-link:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }
        .sidebar .nav-link i {
            margin-right: 12px;
        }

        /* MAIN AREA */
        .main-content {
            flex-grow: 1;
            padding: 20px;
        }

        /* TOPBAR */
        .topbar {
            height: 70px;
            background: #1976d2;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-radius: 8px;
            color: #fff;
            margin-bottom: 20px;
        }

        /* CARDS */
        .card-action {
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border-radius: 20px;
            border: none;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
        }
        .card-action:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
        .icon-circle {
            background: rgba(0,0,0,0.05);
            border-radius: 50%;
            padding: 15px;
            margin-right: 20px;
        }

        /* COLLAPSE ICON HIDE TEXT */
        .sidebar.collapsed .nav-link span {
            display: none;
        }
        .sidebar.collapsed .nav-link i {
            margin: 0;
        }
    </style>
</head>
<body>

<!-- SIDEBAR -->
<nav class="sidebar d-flex flex-column" id="sidebar">
    <div class="sidebar-header">
        <img src="logo.png" style="width: 180px;">
    </div>
    <ul class="nav nav-pills flex-column flex-grow-1 p-2">
        <li><a href="add_user.php" class="nav-link"><i class="bi bi-person-plus"></i><span> Add User</span></a></li>
        <li><a href="add_guesthouse.php" class="nav-link"><i class="bi bi-building"></i><span> Add Guesthouse</span></a></li>
        <li><a href="add_room.php" class="nav-link"><i class="bi bi-door-open"></i><span> Add Room</span></a></li>
        <li><a href="manage_booking.php" class="nav-link"><i class="bi bi-calendar-check"></i><span> Manage Booking</span></a></li>
    </ul>
    <div class="p-3">
        <a href="../logout.php" class="nav-link text-white-50"><i class="bi bi-box-arrow-right"></i><span> Logout</span></a>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="main-content">
    <div class="topbar">
        <h5>Dashboard</h5>
        <div class="d-flex align-items-center">
            <button class="btn btn-light btn-sm me-3" onclick="toggleSidebar()"><i class="bi bi-list"></i></button>
           <?php echo htmlspecialchars($_SESSION['email']); ?>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row g-4">
            <div class="col-md-6 col-lg-4">
                <a href="add_user.php" class="text-decoration-none">
                    <div class="card card-action h-100 p-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle"><i class="bi bi-person-plus fs-3"></i></div>
                            <div><h5>Add User</h5><p>Create new user accounts</p></div>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col-md-6 col-lg-4">
                <a href="add_guesthouse.php" class="text-decoration-none">
                    <div class="card card-action h-100 p-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle"><i class="bi bi-building fs-3"></i></div>
                            <div><h5>Add Guesthouse</h5><p>Add new guesthouse info</p></div>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col-md-6 col-lg-4">
                <a href="add_room.php            " class="text-decoration-none">
                    <div class="card card-action h-100 p-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle"><i class="bi bi-door-open fs-3"></i></div>
                            <div><h5>Add Room</h5><p>Manage rooms in guesthouses</p></div>
                        </div>
                    </div>
                </a>
            </div>

            <div class="col-md-6 col-lg-4">
                <a href="manage_booking.php" class="text-decoration-none">
                    <div class="card card-action h-100 p-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle"><i class="bi bi-calendar-check fs-3"></i></div>
                            <div><h5>Manage Bookings</h5><p>View and handle all bookings</p></div>
                        </div>
                    </div>
                </a>
            </div>

            <div class="col-md-6 col-lg-4">
                <a href="../logout.php" class="text-decoration-none">
                    <div class="card card-action h-100 p-3">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle"><i class="bi bi-box-arrow-right fs-3"></i></div>
                            <div><h5>Logout</h5><p>Sign out from the system</p></div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- SIDEBAR TOGGLE SCRIPT -->
<script>
    function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("collapsed");
    }

    // Highlight current sidebar menu based on URL
    const links = document.querySelectorAll('.sidebar .nav-link');
    links.forEach(link => {
        if (link.href === window.location.href) {
            link.classList.add('active');
        }
    });
</script>

</body>
</html>

<indexx class="php">


</indexx>
<!-- login system -->
 <?php
 session_start();
 include'db_connect.php';

 if($_SERVER["REQUEST_METHOD"]=="POST"){
    $email= $_POST['email'];
    $password= $_POST['password'];

    //user check
$sql = "SELECT * FROM users WHERE email='$email'";
$result=$conn->query($sql);
 
if($result->num_rows == 1){
    $row = $result->fetch_assoc();

    //password verify
    if(password_verify($password,$row['password'])){
        $_SESSION['user_id'] = $row['id'];
        $_SESSION['role'] =$row['role'];
        $_SESSION['email'] = $row['email'];


        if($row['role']== 'admin'){
            header("location:admin/dashboard.php");

        }else{
            header("location:user/dashboard.php");
        }
        exit();
    }else{
        $error="wrong password!";
    }
    }else{
        $error ="user NOT Found!";
    }
}
 
 ?>

 <!DOCTYPE html>
 <html>
    <head>
        <title>Guesthouse Login</title>
       <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> 
    </head>
    <body class="container mt-5">
        <h2>Login</h2>

        <?php 
        if(!empty($error)) echo "<p style='color:red;'>$error</p>";
        ?>

        <form method="POST">
            <div class="mb-3">
                <label>Email:</label>
                <input type="email" name="email" class="form-control" required>
            </div>
            <div class="mb-3">
                <label>Password</label>
                <input type="password" name="password" class="form-control" required>
            </div>
            <button class="btn btn-primary">Login</button>
        </form>
    </body>
 </html>





 manage_booking.php<?php
session_start();
ini_set('display_errors', 1);
error_reporting(E_ALL);

if (!isset($_SESSION['user_id']) || $_SESSION['role'] !== 'admin') {
    header("Location: ../index.php");
    exit();
}

include '../db_connect.php';
include '../includes/mail_config.php';

// Check connection
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

$msg = "";

// Approve / Reject / Cancel booking if requested
if (isset($_GET['action']) && isset($_GET['id'])) {
    $action = $_GET['action'];
    $id = intval($_GET['id']);
    $status = '';

    if ($action === 'cancel') {
        $status = 'cancelled';
    } elseif ($action === 'approve') {
        $status = 'approved';
    } elseif ($action === 'reject') {
        $status = 'rejected';
    }

    if ($status) {
        // fetch room_id and user_id
        $room_id = null;
        $user_id = null;

        $res = $conn->prepare("SELECT room_id, user_id FROM bookings WHERE id = ?");
        $res->bind_param("i", $id);
        $res->execute();
        $res->bind_result($room_id, $user_id);
        $res->fetch();
        $res->close();
        
        $currentStatus = null;
        $stmtCheck = $conn->prepare("SELECT status FROM bookings WHERE id = ?");
        $stmtCheck->bind_param("i", $id);
        $stmtCheck->execute();
        $stmtCheck->bind_result($currentStatus);
        $stmtCheck->fetch();
        $stmtCheck->close();

if ($currentStatus === $status) {
    $_SESSION['flash_msg'] = "Booking is already $status.";
    header("Location: manage_booking.php");
    exit();
}


        // update booking status
        $stmt = $conn->prepare("UPDATE bookings SET status = ? WHERE id = ?");
        if (!$stmt) {
            die("Prepare failed: " . $conn->error);
        }
        $stmt->bind_param("si", $status, $id);
        $stmt->execute();
        if ($stmt->error) {
            die("Update failed: " . $stmt->error);
        }
        $stmt->close();

        // update room status
        if ($room_id) {
            if ($status === 'approved') {
                $up = $conn->prepare("UPDATE rooms SET status = 'booked' WHERE id = ?");
                $up->bind_param("i", $room_id);
                $up->execute();
                $up->close();
            } elseif ($status === 'cancelled' || $status === 'rejected') {
                $up = $conn->prepare("UPDATE rooms SET status = 'available' WHERE id = ?");
                $up->bind_param("i", $room_id);
                $up->execute();
                $up->close();
            }
        }

        // user email nikalna
        $userEmail = null;
        if ($user_id) {
            $stmtUser = $conn->prepare("SELECT email FROM users WHERE id = ?");
            $stmtUser->bind_param("i", $user_id);
            $stmtUser->execute();
            $stmtUser->bind_result($userEmail);
            $stmtUser->fetch();
            $stmtUser->close();
        }
        if ($userEmail) {
    if ($action === 'approve') {
        $subject = "Booking Approved";
        $body = "Congrats! Your booking for room {$room_id} has been approved.";
        sendMail($userEmail, $subject, $body);
    } elseif ($action === 'reject') {
        $subject = "Booking Rejected";
        $body = "Sorry, your booking for room {$room_id} has been rejected.";
        sendMail($userEmail, $subject, $body);
    } elseif ($action === 'cancel') {
        $subject = "Booking Cancelled";
        $body = "Your booking for room {$room_id} has been cancelled by the admin.";
        sendMail($userEmail, $subject, $body);
    }
}
$_SESSION['flash_msg'] = "Booking $status successfully";
header("Location: manage_booking.php");
exit();

        // $msg = "Booking $status successfully";
    }
}

// Fetch all bookings including status
$sql = "
    SELECT
        b.id,
        u.name AS user_name,
        g.name AS guesthouse_name,
        r.room_id AS room_label,
        b.checkin_date,
        b.checkout_date,
        b.status
    FROM bookings b
    JOIN users u ON b.user_id = u.id
    JOIN rooms r ON b.room_id = r.id
    JOIN guesthouses g ON r.guesthouse_id = g.id
    ORDER BY b.checkin_date DESC
";
$result = $conn->query($sql);
if (!$result) {
    die("Query failed: " . $conn->error);
}
?>
<!DOCTYPE html>
<html>
<head>
     <meta charset="UTF-8"/>
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="styleadmin.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css"
          rel="stylesheet">
    
</head>
<body>
 
<!-- SIDEBAR -->
<nav class="sidebar d-flex flex-column" id="sidebar">
    <div class="sidebar-header">
        <img src="logo.png" style="width: 180px;">
    </div>
    <ul class="nav nav-pills flex-column flex-grow-1 p-2">
          <li><a href="dashboard.php" class="nav-link"><i class="bi bi-house-fill"></i> Dashboard</span></a></li>
        <li><a href="add_user.php" class="nav-link"><i class="bi bi-person-plus"></i><span> Add User</span></a></li>
        <li><a href="add_guesthouse.php" class="nav-link"><i class="bi bi-building"></i><span> Add Guesthouse</span></a></li>
        <li><a href="add_room.php" class="nav-link"><i class="bi bi-door-open"></i><span> Add Room</span></a></li>
        <li><a href="manage_booking.php" class="nav-link"><i class="bi bi-calendar-check"></i><span> Manage Booking</span></a></li>
    </ul>
    <div class="p-3">
       <a href="../logout.php" class="nav-link text-dark-50"><i class="bi bi-box-arrow-right"></i><span> Logout</span></a>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="main-content">
    <div class="topbar">
        <h5>Manage</h5>
        <div class="d-flex align-items-center">
            <button class="btn btn-light btn-sm me-3" onclick="toggleSidebar()">
                <i class="bi bi-list"></i></button>
           <?php echo htmlspecialchars($_SESSION['email']); ?>
        </div>
    </div>


        <div class="container mt-4 list-group">
            <h2 class="container mt-4">Manage bookings of USERS</h2>
            <a href="dashboard.php" style="width:200px;" class="btn btn-secondary mb-4">Back to Dashboard</a>

           <?php if (!empty($_SESSION['flash_msg'])) { ?>
        <div class="alert alert-success">
           <?= htmlspecialchars($_SESSION['flash_msg']) ?>
        </div>
        <?php unset($_SESSION['flash_msg']); ?>
        <?php } ?>


            <table class="table table-bordered table-striped" style="width: 50%;">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>User</th>
                        <th>Guesthouse</th>
                        <th>Room</th>
                        <th>CHECK-IN</th>
                        <th>CHECK-OUT</th>
                        <th>Status</th>
                        <th style="width: 400px;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <?php
                    $i = 1;
                    if ($result->num_rows > 0) {
                        while ($row = $result->fetch_assoc()) {
                            ?>
                            <tr>
                                <td><?= $i++ ?></td>
                                <td><?= htmlspecialchars($row['user_name']) ?></td>
                                <td><?= htmlspecialchars($row['guesthouse_name']) ?></td>
                                <td><?= htmlspecialchars($row['room_label']) ?></td>
                                <td><?= htmlspecialchars($row['checkin_date']) ?></td>
                                <td><?= htmlspecialchars($row['checkout_date']) ?></td>
                                <td>
                                    <span class="badge bg-info"><?= htmlspecialchars($row['status']) ?></span>
                                </td>
                                <td>


        <div class="dropdown">
  <button class="btn btn-outline-primary btn-sm dropdown-toggle shadow-sm" 
          type="button" id="actionMenu<?= $row['id'] ?>" 
          data-bs-toggle="dropdown" aria-expanded="false">
    <i class="bi bi-gear-fill me-1"></i>Actions 
  </button>
  
  <ul class="dropdown-menu dropdown-menu-end shadow-sm p-2" 
      aria-labelledby="actionMenu<?= $row['id'] ?>" 
      style="min-width: 180px; border-radius: 8px;">

    <?php if ($row['status'] === 'pending') { ?>
      <li>
        <a href="manage_booking.php?action=approve&id=<?= $row['id'] ?>" 
           class="dropdown-item d-flex align-items-center text-success fw-semibold"
           data-confirm="Approve this booking?">
          <i class="bi bi-check-circle-fill me-2"></i> Approve
        </a>
      </li>
      <li>
        <a href="manage_booking.php?action=reject&id=<?= $row['id'] ?>" 
           class="dropdown-item d-flex align-items-center text-warning fw-semibold"
           data-confirm="Reject this booking?">
          <i class="bi bi-x-circle-fill me-2"></i> Reject
        </a>
      </li>
      <li><hr class="dropdown-divider"></li>
    <?php } ?>

    <?php if ($row['status'] !== 'cancelled') { ?>
      <li>
        <a href="manage_booking.php?action=cancel&id=<?= $row['id'] ?>" 
           class="dropdown-item d-flex align-items-center text-danger fw-semibold"
           data-confirm="Cancel this booking?">
          <i class="bi bi-slash-circle-fill me-2"></i> Cancel
        </a>
      </li>
    <?php } ?>
  </ul>
</div>

                                </td>
                            </tr>
                            <?php
                        }
                    } else {
                        echo "<tr><td colspan='8' class='text-center'>NO Booking FOUND</td></tr>";
                    }
                    ?>
                </tbody>
            </table>
        </div>
    </div>
    
<!-- SIDEBAR TOGGLE SCRIPT -->
<script>
 
    function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("collapsed");
    }

    // Highlight current sidebar menu based on URL
    const links = document.querySelectorAll('.sidebar .nav-link');
    links.forEach(link => {
        if (link.href === window.location.href) {
            link.classList.add('active');
        }
    });
    
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // Ensure links inside dropdown menus actually work
  document.querySelectorAll(".dropdown-menu a").forEach(link => {
    link.addEventListener("click", function(e) {
      // stop Bootstrap from swallowing the event
      e.stopPropagation();
      // manually navigate to href
      const confirmMsg = this.getAttribute("data-confirm");
      if (!confirmMsg || confirm(confirmMsg)) {
        window.location.href = this.getAttribute("href");
      }
    });
  });
});
</script>

</body>
</html>

